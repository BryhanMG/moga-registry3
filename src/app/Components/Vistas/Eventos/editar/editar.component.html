
<div class="header-ce"><div class="container"><h1>Editar Evento</h1></div></div>
<!--<button (click)="createEvento()">Crear</button>-->
<div class="container" >
    <div class="form-ce">
    <div >
      <mat-horizontal-stepper linear="false" #stepper >
        <!--Paso inicial de informacion general-->
        <mat-step [stepControl]="firstFormGroup">
          <form [formGroup]="firstFormGroup">
            <ng-template matStepLabel>General</ng-template>
            
            <div class="row">
              <div class="col-md-6">
                <mat-form-field>
                  <input matInput placeholder="Nombre del evento" maxlength="75" formControlName="nombreE"  required>
                </mat-form-field>
              </div>
              <div class="col-md-6" >
                <mat-form-field>
                  <mat-label>Tipo de evento</mat-label>
                  <mat-select formControlName="tipo" required >
                    <mat-option value="L">Libre</mat-option>
                    <mat-option value="P">De pago</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6" style="margin-top: 1%">
                <mat-form-field>
                  <input matInput [matDatepicker]="dp1" placeholder="Fecha de inicio" bmaxlength="35" formControlName="fechaI" required>
                  <mat-datepicker-toggle matSuffix [for]="dp1"></mat-datepicker-toggle>
                  <mat-datepicker #dp1 disabled="false" ></mat-datepicker>
                </mat-form-field>
              </div> 
              <div class="col-md-6" style="margin-top: 1%">
                <mat-form-field>
                  <input matInput [matDatepicker]="dp2" placeholder="Fecha de finalizacion" maxlength="35" formControlName="fechaF" required>
                  <mat-datepicker-toggle matSuffix [for]="dp2"></mat-datepicker-toggle>
                  <mat-datepicker #dp2 disabled="false" ></mat-datepicker>
                </mat-form-field>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6" style="margin-top: 1%">
                  <mat-form-field>
                      <input matInput atp-time-picker placeholder="Hora de inicio" maxlength="35" formControlName="horaI" required>
                  </mat-form-field>
                
              </div>
              <div class="col-md-6" style="margin-top: 1%;">
                  <mat-form-field>
                      <input matInput atp-time-picker placeholder="Hora de finalizacion" maxlength="35" formControlName="horaF" required>
                  </mat-form-field>
              </div>
            </div>
            <div class="row" *ngIf="evento.tipo === 'P'">
              <div class="col-md-6" style="margin-top: 1%;">
                  <mat-form-field>
                    <input matInput type="number" placeholder="Monto a pagar" formControlName="monto" maxlength="10" required *ngIf="seleccionarTipoEvento()">
                  </mat-form-field>
              </div>
              <div class="col-md-6" style="margin-top: 1%;">
                  <button mat-raised-button  class="base" color="primary" (click)="addCamposDialog()" [disabled]="this.firstFormGroup.get('tipo').value != 'P'">+ Campos de registro</button>
              </div>
            </div>
            <div class="row" *ngIf="evento.tipo === 'P'; else descripcionLibre">
                <div class="col-md-6">
                  <div class="md-form" >
                    <label for="form7" style="margin-top: 30px">Descripción</label>
                    <textarea type="text" id="form7" class="md-textarea form-control" mdbInput style="height: 190px;" maxlength="1000" formControlName="descripcion"></textarea>
                  </div>
                </div>
                  
                <div class="col-md-6" >
                    <div class="md-form" >
                      <mat-form-field >
                        <input matInput placeholder="Categoría" formControlName="categoria" maxlength="75" *ngIf="seleccionarTipoEvento()" (keyup.enter)="addCategoria()">
                      </mat-form-field>
                      <button mat-raised-button class="base" color="primary" style="margin-left: 2%" 
                        [disabled]="this.firstFormGroup.get('tipo').value != 'P'" (click)="addCategoria()">Guardar</button>
                      <cdk-virtual-scroll-viewport itemSize="50" class="example-viewport-actividades" style="height: 190px;" >
                          <mat-list role="list" *ngFor="let cat of evento.categorias">
                            <div class="row">
                              <div class="col-9">
                                <mat-list-item role="cat">{{cat}}</mat-list-item>
                              </div>
                              <div class="col-3">
                                <a (click)="dellCategoria(cat)">
                                  <mat-icon style="margin: 10%">delete</mat-icon>
                                </a>
                              </div>
                            </div>
                            <mat-divider></mat-divider>
                          </mat-list>
                      </cdk-virtual-scroll-viewport>
                  </div>
                </div>
            </div>
            <ng-template #descripcionLibre>
              <div class="md-form" >
                <label for="form7" style="margin-top: 30px">Descripción</label>
                <textarea type="text" id="form7" class="md-textarea form-control" mdbInput style="height: 190px;" maxlength="1000" formControlName="descripcion"></textarea>
              </div>
            </ng-template>
            

            <div class="row" style="margin-top: 3%">
                <div class="col-md-3">
                    <button mat-raised-button class="base" color="primary" (click)="mover()">Siguiente</button>
                </div>
                <div class="col-md-9">
                  <span class="float-right"><button mat-raised-button class="base" color="primary" style="margin-left: 5px; width: 90px"  (click)="backClicked()">Cerrar</button></span>
                  <span class="float-right"><button mat-raised-button class="base" color="primary" style="margin-left: 5px; width: 90px" (click)="obtenerFHIFHF_F1(true)">Guardar</button></span>
                </div>
              </div>
          </form>
        </mat-step>
        <!--Segundo paso, generacion de actividades-->
        <mat-step [stepControl]="secondFormGroup">
          <form [formGroup]="secondFormGroup">
            
            <ng-template matStepLabel>Actividades</ng-template>
            
            <div *ngIf="evento.tipo === 'L'; else pago">
              <div class="row">
                <div class="col-md-6" >
                  <mat-form-field>
                    <input matInput placeholder="Nombre del evento *" maxlength="75" formControlName="nombreA" >
                  </mat-form-field>
                </div>
                <div class="col-md-6" >
                  <div style="padding-top: 5%">
                    <mat-checkbox (click)="activacionGenerica()" formControlName="checked">Actividad genérica</mat-checkbox>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6" style="margin-top: 2%">
                  <p>Tipo de actividad: Libre</p>
                </div>
                <div class="col-md-6" style="margin-top: 2%">
                  <mat-form-field>
                    <mat-label>Escoger fecha *</mat-label>
                    <mat-select formControlName="fecha"  >
                      <mat-option *ngFor="let fecha of listaFechas" [value]="fecha['fecha']">{{fecha["sFecha"]}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6" style="margin-top: 2%">
                  <mat-form-field>
                    <input matInput atp-time-picker placeholder="Hora de inicio *" maxlength="35" formControlName="horaI" >
                  </mat-form-field>
                </div>
                <div class="col-md-6" style="margin-top: 1%; margin-bottom: 2%">
                    <mat-form-field>
                        <input matInput atp-time-picker placeholder="Hora de finalizacion *" maxlength="35" formControlName="horaF" >
                    </mat-form-field>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-4" style="margin-top: 2%">
                    <div class="md-form" >
                        <label for="form7" >Descripción</label>
                        
                        <textarea type="text" id="form7" class="md-textarea form-control" mdbInput style="height: 190px;" maxlength="1000" formControlName="descripcion"></textarea>
                        
                      </div>
                </div>
                <div class="col-md-8" style="margin-top: 2%">
                    <div class="md-form" >
                        <button mat-raised-button class="base" color="primary" style="margin-right: 1%" (click)="comprobarInformacionActividad()" *ngIf="!feditar; else actualizar">Guardar</button>
                        <ng-template #actualizar>
                            <button mat-raised-button class="base" color="primary" style="margin-right: 1%" (click)="comprobarInformacionActividad()">Actualizar</button>
                            <button mat-raised-button class="base" color="primary" style="margin-right: 1%" (click)="limpiarCampos()">Cancelar</button>
                        </ng-template>
                        <cdk-virtual-scroll-viewport itemSize="50" class="example-viewport-actividades" >
                            <mat-accordion>
              
                                <mat-expansion-panel *ngFor="let actividad of listaActividades">
                                  <!--Titulos-->
                                  
                                  <mat-expansion-panel-header>
                                    <table style="width: 100%">
                                      <thead>
                                        <th style="width: 30%">
                                          <mat-panel-title>
                                            {{obtenerTipoActividad(actividad['actividad'].tipo)}}
                                          </mat-panel-title>
                                        </th>
                                        <th style="width: 50%">
                                          <mat-panel-description>
                                            {{actividad['actividad'].nombre_a}}
                                          </mat-panel-description>
                                        </th>
                                        
                                        <th style="width: 20%">
                                          <mat-panel-description>
                                            <a (click)="editarActividad(actividad)" style="margin-right: 10px">
                                              <mat-icon matTooltip="Editar actividad">edit</mat-icon>
                                            </a>
                                            <a (click)="deleteActividad(actividad['id'])">
                                              <mat-icon matTooltip="Eliminar actividad">delete</mat-icon>
                                            </a>
                                          </mat-panel-description>
                                        </th>
                                      </thead>
                                    </table>
                                    
                                    
                                    
                                  </mat-expansion-panel-header>
                                  <!--campos del desplegable-->
                                    <p>Descripcion: {{actividad['actividad'].descripcion}}</p>
                                    <div class="row">
                                      <div class="col-sm-6">Fecha de Inicio: {{actividad['actividad'].fecha_i.substring(0, 10)}} ---- {{actividad['actividad'].fecha_i.substring(11, 16)}} Hrs.</div>
                                      <div class="col-sm-6">Fecha Fin: {{actividad['actividad'].fecha_f.substring(0, 10)}} ---- {{actividad['actividad'].fecha_f.substring(11, 16)}} Hrs.</div>
                                    </div>
                                    <br>
                                    
                                </mat-expansion-panel>
                              </mat-accordion>
                        </cdk-virtual-scroll-viewport>
                    </div>
                </div>
              </div>
            </div>

            <ng-template #pago>
                <div>
                    <div class="row">
                      <div class="col-md-6" >
                        <mat-form-field>
                          <input matInput placeholder="Nombre de la actividad *" maxlength="75" formControlName="nombreA" >
                        </mat-form-field>
                      </div>
                      <div class="col-md-6" >
                          <mat-form-field>
                            <mat-label>Tipo de actividad *</mat-label>
                            <mat-select type="number" formControlName="tipo">
                              <mat-option value="1">General</mat-option>
                              <mat-option value="2">Especial de pago</mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6" style="margin-top: 2%">
                        <mat-form-field>
                          <mat-label>Escoger fecha *</mat-label>
                          <mat-select formControlName="fecha"  >
                            <mat-option *ngFor="let fecha of listaFechas" [value]="fecha['fecha']">{{fecha["sFecha"]}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="col-md-6" style="margin-top: 1%; margin-bottom: 2%">
                        <mat-form-field>
                          <input matInput placeholder="Monto *" maxlength="10" formControlName="monto" *ngIf="seleccionTipoActividad()">
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6" style="margin-top: 2%">
                        <mat-form-field>
                          <input matInput atp-time-picker placeholder="Hora de inicio *" maxlength="35" formControlName="horaI" >
                        </mat-form-field>
                      </div>
                      <div class="col-md-6" style="margin-top: 1%; margin-bottom: 2%">
                          <mat-form-field>
                              <input matInput atp-time-picker placeholder="Hora de finalizacion *" maxlength="35" formControlName="horaF" >
                          </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4" style="margin-top: 1%">
                          <div class="md-form" >
                            <label for="form7" >Descripción</label>
                            <textarea type="text" id="form7" class="md-textarea form-control" mdbInput style="height: 225px;" maxlength="1000" formControlName="descripcion"></textarea>
                          </div>
                      </div>
                      <div class="col-md-8" >
                          <div class="md-form" >
                            
                            <button mat-raised-button class="base" color="primary" style="margin-right: 1%" (click)="comprobarInformacionActividad()" *ngIf="!feditar; else actualizar">Guardar</button>
                            <ng-template #actualizar>
                              <button mat-raised-button class="base" color="primary" style="margin-right: 1%" (click)="comprobarInformacionActividad()">Actualizar</button>
                              <button mat-raised-button class="base" color="primary" style="margin-right: 1%" (click)="limpiarCampos()">Cancelar</button>
                            </ng-template>
                            <cdk-virtual-scroll-viewport itemSize="50" class="example-viewport-actividades" style="height: 225px;" >
                                <mat-accordion>
                  
                                    <mat-expansion-panel *ngFor="let actividad of listaActividades">
                                      <!--Titulos-->
                                      
                                      <mat-expansion-panel-header>
                                        <table style="width: 100%">
                                          <thead>
                                            <th style="width: 40%">
                                              <mat-panel-title>
                                                {{obtenerTipoActividad(actividad['actividad'].tipo)}}
                                              </mat-panel-title>
                                            </th>
                                            <th style="width: 40%">
                                              <mat-panel-description>
                                                {{actividad['actividad'].nombre_a}}
                                              </mat-panel-description>
                                            </th>
                                            <th style="width: 20%">
                                              <mat-panel-description>
                                                <a (click)="editarActividad(actividad)" style="margin-right: 10px">
                                                  <mat-icon matTooltip="Editar actividad">edit</mat-icon>
                                                </a>
                                                <a (click)="deleteActividad(actividad['id'])">
                                                  <mat-icon matTooltip="Eliminar actividad">delete</mat-icon>
                                                </a>
                                              </mat-panel-description>
                                            </th>
                                          </thead>
                                        </table>
                                        
                                      </mat-expansion-panel-header>
                                      <!--campos del desplegable-->
                                        <h5>Descripcion: {{actividad['actividad'].descripcion}}</h5>
                                        <h5 *ngIf="actividad['actividad'].tipo == 2">Monto: {{actividad['actividad'].monto}}</h5>
                                        <div class="row">
                                          <div class="col-sm-6">Fecha de Inicio: {{actividad['actividad'].fecha_i.substring(0, 10)}} ---- {{actividad['actividad'].fecha_i.substring(11, 16)}} Hrs.</div>
                                          <div class="col-sm-6">Fecha Fin: {{actividad['actividad'].fecha_f.substring(0, 10)}} ---- {{actividad['actividad'].fecha_f.substring(11, 16)}} Hrs.</div>
                                        </div>
                                        <br>
                                        
                                    </mat-expansion-panel>
                                  </mat-accordion>
                            </cdk-virtual-scroll-viewport>
                        </div>
                      </div>
                    </div>
                  </div>

              <div class="row" *ngIf="evento.tipo === 'T'">
                <div class="col-md-6" style="margin-top: 2%">
                  <mat-form-field>
                    <input matInput placeholder="Monto *" maxlength="10" formControlName="monto">
                  </mat-form-field>
                </div>
                <div class="col-md-6" style="margin-top: 1%; margin-bottom: 2%">
                  <mat-form-field>
                    <input matInput placeholder="Total participantes *" maxlength="10" formControlName="total">
                  </mat-form-field>
                </div>
              </div>
            </ng-template>
            <mat-divider style="margin-top: 2%"></mat-divider>
            
          </form>
          <div class="row" style="margin-top: 3%">
              <div class="col-md-3">
                <button mat-raised-button matStepperPrevious class="base" color="primary">Regresar</button>
                <button mat-raised-button class="base" color="primary" (click)="mover()">Siguiente</button>
              </div>
              <div class="col-md-9">
                <label *ngIf="fGuardado">*Aun debe guarda los cambios hechos</label>
                <span class="float-right"><button mat-raised-button class="base" color="primary" style="margin-left: 5px; width: 90px"  (click)="backClicked()">Cerrar</button></span>
                <span class="float-right"><button mat-raised-button class="base" color="primary" style="margin-left: 5px; width: 90px" (click)="actualizarActividades()">Guardar</button></span>
              </div>
            </div>
          
        </mat-step>
        <!--Paso de seleccion de responsables-->
        <mat-step>
          <ng-template matStepLabel>Responsables</ng-template>
          <div class="container">
            <cdk-virtual-scroll-viewport itemSize="50" class="example-viewport-responsables" >
              <table class="table">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">Código</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Estado</th>
                    </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let a of responsables">
                    <td style="font-size: 16px; padding-top: 2%">{{a.administrador._id}}</td>
                    <td style="font-size: 16px; padding-top: 2%">{{a.nombres}} {{a.apellidos}}</td>
                    <td >
                      <button mat-raised-button class="base" color="primary" style=" margin-right: 20px" (click)="activarDesactivar(a)"><mat-icon>{{a.estado}}</mat-icon></button>
                    </td>
                  </tr>

                </tbody>
              </table>
            </cdk-virtual-scroll-viewport>
          </div>
          <div style="margin-top: 3%">
            <div class="row" style="margin-top: 3%">
              <div class="col-md-3">
                <button mat-raised-button matStepperPrevious class="base" color="primary">Regresar</button>
              </div>
              <div class="col-md-9">
                  <span class="float-right"><button mat-raised-button class="base" color="primary" style="margin-left: 5px; width: 90px" (click)="backClicked()">Cerrar</button></span>
                <span class="float-right"><button mat-raised-button class="base" color="primary" style="margin-left: 5px; width: 90px" (click)="actualizarResponsables()">Guardar</button></span>
              </div>
            </div>
          </div>
        </mat-step>
        
      </mat-horizontal-stepper>
    </div>
    
</div>  
 </div>
 <div class="footer-ce"></div>
 